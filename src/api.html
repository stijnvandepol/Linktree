<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Users – Client Filter</title>
  <style>body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:2rem} pre{background:#f6f8fa;padding:1rem;overflow:auto;border-radius:8px}</style>
</head>
<body>
  <h1>Users – Client-side filtering</h1>
  <p>Gebruik URL-parameters, bv. <code>?username=sophie</code> of <code>?group=Domain%20Users</code>.</p>
  <pre id="out">laden…</pre>
  <script>
    const ci = s => (s||'').toLowerCase();
    const eqCI = (a,b) => ci(a)===ci(b);
    const arrHasCI = (arr, v) => (arr||[]).some(x => eqCI(x, v));

    const u = new URL(window.location.href);
    const p = {
      username: u.searchParams.get('username') || '',
      group:    u.searchParams.get('group') || '',
      role:     u.searchParams.get('role') || '',
      right:    u.searchParams.get('right') || '',
      enabled:  u.searchParams.get('enabled') // "true" | "false" | null
    };

    fetch('./users.json')
      .then(r => r.json())
      .then(raw => {
        const users = Array.isArray(raw) ? raw : (raw.users || []);
        const filtered = users.filter(x => {
          if (p.username && !eqCI(x.username, p.username) && !ci(x.displayName).includes(ci(p.username))) return false;
          if (p.group && !arrHasCI(x.groups, p.group)) return false;
          if (p.role && !arrHasCI(x.roles, p.role)) return false;
          if (p.right && !arrHasCI(x.rights, p.right)) return false;
          if (p.enabled !== null && p.enabled !== '' && String(!!x.enabled) !== String(p.enabled)) return false;
          return true;
        });
        document.getElementById('out').textContent = JSON.stringify(filtered, null, 2);
      })
      .catch(e => document.getElementById('out').textContent = 'Fout: '+e);
  </script>
</body>
</html>
